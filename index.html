<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Love‑Is Style Collage — Pure HTML/CSS/JS</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Marck+Script&family=Poiret+One&family=Lobster&family=Comfortaa:wght@400;700&family=Pacifico&family=Russo+One&family=Montserrat:wght@500;700&display=swap');

    :root{ --ui:#111827; --bd:#cbd5e1; --bg:#f3f4f6; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body { margin: 0; background: var(--bg); font-family: 'Montserrat', system-ui; display: flex; justify-content: center; align-items: center; min-height: 100vh; }

    .app{ display:flex; align-items:flex-start; gap:16px; padding:16px; width: min(1100px, 100%); }

    canvas { border: 2px solid #111; background: #fff; width: 100%; max-width: 480px; height: auto; border-radius: 10px; box-shadow: 0 8px 24px rgba(0,0,0,.08); touch-action: manipulation; }

    .controls { flex:1; margin-left: 20px; display: grid; gap: 12px; align-content: start; max-width: 520px; padding: 10px 0; }
    .controls label { display:block; font-size:14px; color:#111; margin-bottom:4px; }
    .controls input[type="text"], .controls select, .controls input[type="range"] { width: 100%; padding: 12px 14px; border: 1px solid var(--bd); border-radius: 10px; background:#fff; font-size:16px; }
    .row { display:grid; gap:8px; }
    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .btns { display:flex; gap:10px; flex-wrap:wrap; margin:4px 0 12px; }
    button { height:44px; padding: 0 14px; border: 1px solid var(--ui); background: var(--ui); color:#fff; cursor: pointer; border-radius: 10px; font-weight:600; font-size:16px; }
    button.secondary{ background:#fff; color:var(--ui); }
    button:active{ transform: translateY(1px); }
    button:hover { filter: brightness(1.05); }
    small.hint{color:#475569}

    /* БОльшие ползунки для тач-устройств */
    input[type="range"]{ -webkit-appearance:none; appearance:none; height: 6px; border-radius: 999px; background:#e5e7eb; }
    input[type="range"]::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:28px; height:28px; border-radius:50%; background:#111827; border:2px solid #0ea5e9; }
    input[type="range"]::-moz-range-thumb{ width:28px; height:28px; border:none; border-radius:50%; background:#111827; }

    /* Мобильная компоновка */
    @media (max-width: 700px){
      body{ align-items: stretch; }
      .app{ flex-direction: column; padding:12px; gap:12px; }
      .controls{ margin-left:0; max-width:100%; }
      canvas{ max-width: 100%; }
      .grid2{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="stage">
      <canvas id="canvas" width="800" height="1200"></canvas>
    </div>
  <div class="controls">
    <div class="row">
      <label>Загрузить фото</label>
      <input type="file" id="fileInput" accept="image/*">
      <div class="btns">
        <button id="replaceBtn" class="secondary">Заменить фото</button>
        <button id="removeBtn" class="secondary">Удалить фото</button>
      </div>
      <small class="hint">Холст авто‑масштабируется под качество фото (до ~1600px по ширине) и экспортируется в полном размере.</small>
    </div>

    <div class="row">
      <label for="topText">Верхний текст</label>
      <input type="text" id="topText" value="Любовь это… / Love is…">
      <div class="grid2">
        <div class="row">
          <label for="topFont">Шрифт верхнего текста</label>
          <select id="topFont">
            <option value="Marck Script" selected>Marck Script (рукописный)</option>
            <option value="Poiret One">Poiret One (элегантный)</option>
            <option value="Pacifico">Pacifico (романтичный)</option>
            <option value="Lobster">Lobster (афиша)</option>
            <option value="Comfortaa">Comfortaa (геометр.)</option>
            <option value="Russo One">Russo One (жирный)</option>
            <option value="Montserrat">Montserrat (универс.)</option>
          </select>
        </div>
        <div class="row">
          <label for="topSize">Размер верхнего текста</label>
          <input type="range" id="topSize" min="24" max="96" step="1" value="48">
        </div>
      </div>
    </div>

    <div class="row">
      <label for="bottomText">Нижний текст</label>
      <input type="text" id="bottomText" value="…слышать сердцебиение друг друга.">
      <div class="grid2">
        <div class="row">
          <label for="bottomFont">Шрифт нижнего текста</label>
          <select id="bottomFont">
            <option value="Poiret One" selected>Poiret One (элегантный)</option>
            <option value="Marck Script">Marck Script (рукописный)</option>
            <option value="Pacifico">Pacifico (романтичный)</option>
            <option value="Lobster">Lobster (афиша)</option>
            <option value="Comfortaa">Comfortaa (геометр.)</option>
            <option value="Russo One">Russo One (жирный)</option>
            <option value="Montserrat">Montserrat (универс.)</option>
          </select>
        </div>
        <div class="row">
          <label for="bottomSize">Размер нижнего текста</label>
          <input type="range" id="bottomSize" min="20" max="80" step="1" value="40">
        </div>
      </div>
    </div>

    <div class="row">
      <label for="frameThick">Толщина рамки</label>
      <input type="range" id="frameThick" min="1" max="20" step="1" value="2">
    </div>

    <div class="btns">
      <button id="download">Скачать PNG</button>
    </div>
  </div>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const BASE_W = 800, BASE_H = 1200;
    // масштаб предпросмотра под экран (CSS управляет шириной), реальный экспорт по пикселям canvas
    function fitCanvasForMobile(){
      // ничего не меняем в пикселях canvas — только визуальная ширина через CSS уже адаптивна
      // оставлено для будущих доработок (например, devicePixelRatio масштаб экспорта)
    }
    fitCanvasForMobile();

    const fileInput = document.getElementById('fileInput');
    const topTextInput = document.getElementById('topText');
    const bottomTextInput = document.getElementById('bottomText');
    const downloadBtn = document.getElementById('download');
    const replaceBtn = document.getElementById('replaceBtn');
    const removeBtn = document.getElementById('removeBtn');
    const topFontSel = document.getElementById('topFont');
    const bottomFontSel = document.getElementById('bottomFont');
    const topSizeEl = document.getElementById('topSize');
    const bottomSizeEl = document.getElementById('bottomSize');
    const frameThickEl = document.getElementById('frameThick');

    const FONT_MAP = {
      'Marck Script': '"Marck Script", cursive',
      'Poiret One': '"Poiret One", cursive',
      'Lobster': '"Lobster", cursive',
      'Comfortaa': '"Comfortaa", cursive',
      'Pacifico': '"Pacifico", cursive',
      'Russo One': '"Russo One", sans-serif',
      'Montserrat': '"Montserrat", sans-serif'
    };

    let img = null;

    function drawHeart(ctx, cx, cy, r, color){
      ctx.save(); ctx.translate(cx, cy); ctx.beginPath();
      for(let a=0; a<Math.PI*2; a+=0.02){
        const x = r*16*Math.pow(Math.sin(a),3)/16;
        const y = -r*(13*Math.cos(a)-5*Math.cos(2*a)-2*Math.cos(3*a)-Math.cos(4*a))/16;
        if(a===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.fillStyle = color; ctx.fill(); ctx.restore();
    }

    function draw() {
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Рамка карточки
      const border = parseInt(frameThickEl.value || '2', 10);
      ctx.strokeStyle = '#111';
      ctx.lineWidth = border;
      ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);

      // Верхний текст
      ctx.fillStyle = '#111';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'alphabetic';
      const topFontFamily = FONT_MAP[topFontSel.value] || FONT_MAP['Marck Script'];
      const topSize = parseInt(topSizeEl.value || '48', 10);
      ctx.font = `${topSize}px ${topFontFamily}`;
      ctx.fillText(topTextInput.value, 40, 90);

      // Фото
      if (img) {
        const maxWidth = canvas.width - 80;
        const maxHeight = canvas.height - 300;
        const ratio = Math.min(maxWidth / img.width, maxHeight / img.height);
        const newWidth = img.width * ratio;
        const newHeight = img.height * ratio;
        const x = (canvas.width - newWidth) / 2;
        const y = (canvas.height - newHeight) / 2;
        ctx.imageSmoothingQuality = 'high';
        ctx.drawImage(img, x, y, newWidth, newHeight);
      }

      // Сердечки — поверх фото
      drawHeart(ctx, canvas.width - 130, 100, 36, '#e11d48');
      drawHeart(ctx, canvas.width - 100, 120, 32, '#ef4444');

      // Нижний текст
      ctx.textAlign = 'center';
      const bottomFontFamily = FONT_MAP[bottomFontSel.value] || FONT_MAP['Poiret One'];
      const bottomSize = parseInt(bottomSizeEl.value || '40', 10);
      ctx.font = `${bottomSize}px ${bottomFontFamily}`;
      ctx.fillText(bottomTextInput.value, canvas.width / 2, canvas.height - 80);
    }

    function loadFile(file){
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(evt) {
        img = new Image();
        img.onload = () => {
          const scaleFactor = Math.min(img.width, 1600) / BASE_W;
          canvas.width = Math.round(BASE_W * scaleFactor);
          canvas.height = Math.round(BASE_H * scaleFactor);
          draw();
        };
        img.src = evt.target.result;
      }
      reader.readAsDataURL(file);
    }

    fileInput.addEventListener('change', (e) => loadFile(e.target.files[0]));

    replaceBtn.addEventListener('click', () => { fileInput.value = ''; fileInput.click(); });
    removeBtn.addEventListener('click', () => { img = null; canvas.width = BASE_W; canvas.height = BASE_H; draw(); });

    topTextInput.addEventListener('input', draw);
    bottomTextInput.addEventListener('input', draw);
    topFontSel.addEventListener('change', draw);
    bottomFontSel.addEventListener('change', draw);
    topSizeEl.addEventListener('input', draw);
    bottomSizeEl.addEventListener('input', draw);
    frameThickEl.addEventListener('input', draw);

    downloadBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'loveis.png';
      link.href = canvas.toDataURL('image/png', 1.0);
      link.click();
    });

    draw();
  </script>
</body>
</html>
