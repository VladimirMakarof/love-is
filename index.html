<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Love‑Is Style Collage — Pure HTML/CSS/JS</title>
  <style>
    /* Подключаем несколько гарнитур с красивой кириллицей */
    @import url('https://fonts.googleapis.com/css2?family=Marck+Script&family=Poiret+One&family=Lobster&family=Comfortaa:wght@400;700&family=Pacifico&family=Russo+One&family=Montserrat:wght@500;700&display=swap');

    body {
      margin: 0;
      font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, Arial;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #f3f4f6;
    }
    canvas {
      border: 2px solid #111;
      background: white;
      max-width: 420px; /* предпросмотр не огромный */
      height: auto;
      border-radius: 10px;
      box-shadow: 0 8px 24px rgba(0,0,0,.08);
    }
    .controls {
      margin-left: 20px;
      display: grid;
      gap: 10px;
      align-content: start;
      max-width: 420px;
      padding: 10px 0;
    }
    .controls label { display:block; font-size:14px; color:#111; margin-bottom:4px; }
    .controls input[type="text"], .controls select {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      background:#fff;
      font-size:14px;
    }
    .row { display:grid; gap:6px; }
    .btns { display:flex; gap:8px; flex-wrap:wrap; margin:4px 0 12px; }
    button {
      padding: 8px 12px;
      border: 1px solid #111827;
      background: #111827;
      color:#fff;
      cursor: pointer;
      border-radius: 8px;
      font-weight:600;
    }
    button.secondary{ background:#fff; color:#111827; }
    button:hover { filter: brightness(1.05); }
  </style>
</head>
<body>
  <div>
    <canvas id="canvas" width="800" height="1200"></canvas>
  </div>
  <div class="controls">
    <div class="row">
      <label>Загрузить фото</label>
      <input type="file" id="fileInput" accept="image/*">
      <div class="btns">
        <button id="replaceBtn" class="secondary">Заменить фото</button>
        <button id="removeBtn" class="secondary">Удалить фото</button>
      </div>
    </div>

    <div class="row">
      <label for="topText">Верхний текст</label>
      <input type="text" id="topText" value="Любовь это… / Love is…">
      <label for="topFont">Шрифт верхнего текста</label>
      <select id="topFont">
        <option value="Marck Script" selected>Marck Script (рукописный)</option>
        <option value="Poiret One">Poiret One (элегантный)</option>
        <option value="Pacifico">Pacifico (романтичный)</option>
        <option value="Lobster">Lobster (афиша)</option>
        <option value="Comfortaa">Comfortaa (мягкий геометр.)</option>
        <option value="Russo One">Russo One (жирный гротеск)</option>
        <option value="Montserrat">Montserrat (универсальный)</option>
      </select>
    </div>

    <div class="row">
      <label for="bottomText">Нижний текст</label>
      <input type="text" id="bottomText" value="…слышать сердцебиение друг друга.">
      <label for="bottomFont">Шрифт нижнего текста</label>
      <select id="bottomFont">
        <option value="Poiret One" selected>Poiret One (элегантный)</option>
        <option value="Marck Script">Marck Script (рукописный)</option>
        <option value="Pacifico">Pacifico (романтичный)</option>
        <option value="Lobster">Lobster (афиша)</option>
        <option value="Comfortaa">Comfortaa (мягкий геометр.)</option>
        <option value="Russo One">Russo One (жирный гротеск)</option>
        <option value="Montserrat">Montserrat (универсальный)</option>
      </select>
    </div>

    <div class="btns">
      <button id="download">Скачать PNG</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const BASE_W = 800, BASE_H = 1200;

    const fileInput = document.getElementById('fileInput');
    const topTextInput = document.getElementById('topText');
    const bottomTextInput = document.getElementById('bottomText');
    const downloadBtn = document.getElementById('download');
    const replaceBtn = document.getElementById('replaceBtn');
    const removeBtn = document.getElementById('removeBtn');
    const topFontSel = document.getElementById('topFont');
    const bottomFontSel = document.getElementById('bottomFont');

    // Отображаемые гарнитуры -> CSS font-family для canvas
    const FONT_MAP = {
      'Marck Script': '"Marck Script", cursive',
      'Poiret One': '"Poiret One", cursive',
      'Lobster': '"Lobster", cursive',
      'Comfortaa': '"Comfortaa", cursive',
      'Pacifico': '"Pacifico", cursive',
      'Russo One': '"Russo One", sans-serif',
      'Montserrat': '"Montserrat", sans-serif'
    };

    let img = null;

    function drawHeart(ctx, cx, cy, r, color){
      ctx.save();
      ctx.translate(cx, cy);
      ctx.beginPath();
      for(let a=0; a<Math.PI*2; a+=0.02){
        const x = r*16*Math.pow(Math.sin(a),3)/16;
        const y = -r*(13*Math.cos(a)-5*Math.cos(2*a)-2*Math.cos(3*a)-Math.cos(4*a))/16;
        if(a===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.fillStyle = color;
      ctx.fill();
      ctx.restore();
    }

    function draw() {
      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Рамка карточки
      ctx.strokeStyle = '#111';
      ctx.lineWidth = 2;
      ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);

      // Верхний текст
      ctx.fillStyle = '#111';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'alphabetic';
      const topFontFamily = FONT_MAP[topFontSel.value] || FONT_MAP['Marck Script'];
      ctx.font = `48px ${topFontFamily}`;
      ctx.fillText(topTextInput.value, 40, 90);

      // Сердечки в правом верхнем углу
      drawHeart(ctx, canvas.width - 160, 110, 32, '#e11d48');
      drawHeart(ctx, canvas.width - 110, 130, 28, '#ef4444');

      // Нижний текст
      ctx.textAlign = 'center';
      const bottomFontFamily = FONT_MAP[bottomFontSel.value] || FONT_MAP['Poiret One'];
      ctx.font = `40px ${bottomFontFamily}`;
      ctx.fillText(bottomTextInput.value, canvas.width / 2, canvas.height - 80);

      // Фото (вписываем без обрезки)
      if (img) {
        const maxWidth = canvas.width - 80;
        const maxHeight = canvas.height - 300;
        const ratio = Math.min(maxWidth / img.width, maxHeight / img.height);
        const newWidth = img.width * ratio;
        const newHeight = img.height * ratio;
        const x = (canvas.width - newWidth) / 2;
        const y = (canvas.height - newHeight) / 2;
        ctx.imageSmoothingQuality = 'high';
        ctx.drawImage(img, x, y, newWidth, newHeight);
      }
    }

    function loadFile(file){
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(evt) {
        img = new Image();
        img.onload = () => {
          // Авто‑масштаб под качество фото, ограничение по ширине 1600
          const scaleFactor = Math.min(img.width, 1600) / BASE_W;
          canvas.width = Math.round(BASE_W * scaleFactor);
          canvas.height = Math.round(BASE_H * scaleFactor);
          draw();
        };
        img.src = evt.target.result;
      }
      reader.readAsDataURL(file);
    }

    fileInput.addEventListener('change', (e) => loadFile(e.target.files[0]));

    replaceBtn.addEventListener('click', () => {
      fileInput.value = '';
      fileInput.click();
    });

    removeBtn.addEventListener('click', () => {
      img = null;
      canvas.width = BASE_W;
      canvas.height = BASE_H;
      draw();
    });

    topTextInput.addEventListener('input', draw);
    bottomTextInput.addEventListener('input', draw);
    topFontSel.addEventListener('change', draw);
    bottomFontSel.addEventListener('change', draw);

    downloadBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'loveis.png';
      link.href = canvas.toDataURL('image/png', 1.0);
      link.click();
    });

    draw();
  </script>
</body>
</html>
